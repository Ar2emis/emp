%div#dataset
  %div
    %div
      - @correlation_fields.each_slice(7).with_index do |fields, index|
        - if params[:dimensions].present?
          %h2.text-center.my-4=index.next
        - fields.each do |field|
          %div
            =image_tag field.html_safe, class: 'img-fluid mx-auto d-block mt-4 img-thumbnail border-3'
      - if params[:dimensions].present?
        .mt-2.mb-4.ms-4
          %p Линейная, стохастическая, отрицательная связь в парах: 1-2
          %p Нелинейная, стохастическая, отрицательная связь в парах: 1-3, 1-4, 1-5, 2-6, 2-7, 2-8
          %p Линейная, стохастическая, положительная связь в парах: 1-7, 1-8, 3-4, 4-5, 4-7, 5-6, 5-7, 5-8, 6-7
          %p Нелинейная, стохастическая, положительная связь в парах: 1-6, 2-3, 2-4, 2-5, 3-5, 3-6, 3-7, 3-8, 4-6, 4-8, 6-8
          %p Нет связи в паре: 7-8
          %p В данных присутствуют аномалии в 3, 4
  %div
    - @statistics.each do |key, statistics|
      %table.table.table-striped.m-auto.mt-4.w-75.border.text-center
        %thead.table-dark
          %tr
            %th=key
            %th Значение
            %th СКО
            %th 95%
        %tbody
          %tr
            %td Среднее
            %td=statistics[:mean][:value].round(2)
            %td=statistics[:mean][:std].round(2)
            %td [#{statistics[:mean][:ninety_five].first.round(2)}; #{statistics[:mean][:ninety_five].last.round(2)}]
          %tr
            %td Медиана
            %td=statistics[:median][:value].round(2)
            %td -
            %td [#{statistics[:median][:ninety_five].first.round(2)}; #{statistics[:median][:ninety_five].last.round(2)}]
          %tr
            %td СКО
            %td=statistics[:std][:value].round(2)
            %td=statistics[:std][:std].round(2)
            %td [#{statistics[:std][:ninety_five].first.round(2)}; #{statistics[:std][:ninety_five].last.round(2)}]
          %tr
            %td Коэффициент Асимметрии
            %td=statistics[:assymetry][:value].round(2)
            %td=statistics[:assymetry][:std].round(2)
            %td [#{statistics[:assymetry][:ninety_five].first.round(2)}; #{statistics[:assymetry][:ninety_five].last.round(2)}]
          %tr
            %td Коэффициент Эксцесса
            %td=statistics[:excess][:value].round(2)
            %td=statistics[:excess][:std].round(2)
            %td [#{statistics[:excess][:ninety_five].first.round(2)}; #{statistics[:excess][:ninety_five].last.round(2)}]
    - if params[:dimensions].blank?
      %div
        %table.table.table-striped.m-auto.mt-4.w-75.border.text-center
          %thead.table-dark
            %tr
              %th Коэффициент Корреляции
              %th Оценка
              %th SciPy
              %th 95%
              %th Статистика
              %th Квантиль
              %th Значимость
              %th Зависимость
          %tbody
            %tr
              %th Пирсона
              %th=@pearson[:value]
              %th -
              %th="[#{@pearson[:ninety_five].first.round(2)}; #{@pearson[:ninety_five].last.round(2)}]"
              %th=@pearson[:statistic]
              %th=@pearson[:quantile]
              - if @pearson[:statistic].abs <= @pearson[:quantile]
                %th Незначимый
                %th Нет
              - else
                %th Значимый
                %th Да
            %tr
              %th Спирмена
              %th=@spirmen[:value]
              %th=@spirmen[:scipy]
              %th -
              %th=@spirmen[:statistic]
              %th=@spirmen[:quantile]
              - if @spirmen[:statistic].abs <= @spirmen[:quantile]
                %th Незначимый
                %th Нет
              - else
                %th Значимый
                %th Да
            %tr
              %th Кендалла
              %th=@kendall[:value]
              %th=@kendall[:scipy]
              %th -
              %th=@kendall[:statistic]
              %th=@kendall[:quantile]
              - if @kendall[:statistic].abs <= @kendall[:quantile]
                %th Незначимый
                %th Нет
              - else
                %th Значимый
                %th Да
            %tr
              %th Корреляционное отношение
              %th=@corelation_relation[:value]
              %th -
              %th -
              %th=@corelation_relation[:statistic]
              %th=@corelation_relation[:quantile]
              - if @corelation_relation[:statistic] <= @corelation_relation[:quantile]
                %th Незначимое
                %th Нет
              - else
                %th Значимое
                %th Да
      - if @corelation_pearson
        %div
          %table.table.table-striped.m-auto.mt-4.w-75.border.mb-4.text-center
            %thead.table-dark
              %tr
                %th Оценка Пирсона
                %th Оценка Кореляционного Отношения
                %th Статистика
                %th Квантиль
                %th Равность
                %th Линейная зависимость
            %tbody
              %tr
                %th=@corelation_pearson[:pearson]
                %th=@corelation_relation[:value]
                %th=@corelation_pearson[:value]
                %th=@corelation_relation[:quantile]
                - if @corelation_pearson[:value] <= @corelation_relation[:quantile]
                  %th Да
                  %th Да
                - else
                  %th Нет
                  %th Нет
    - else
      %div
        %h3.text-center.mt-4 Spearman
        %table.table.table-striped.m-auto.mt-4.w-75.border.mb-4.text-center
          %thead.table-dark
            %tr
              %th
              - @matrix.count.times do |index|
                %th=index.next
          %tbody
            - @matrix.each_with_index do |row, index|
              %tr
                %td.table-dark=index.next
                - row.each do |col|
                  %td=col[:value].round(2)
        .ms-4.my-4
          %p Пары 2-3, 3-5 имеют модуль коэффициента корреляции близкий к 1 (>= 0.9)
          %p Показатель 3 сильнее всего коррелирует с показателем 5

